<!doctype html>
<html>
  <head><meta charset="utf-8"><title>Plaid Link (Prod)</title></head>
  <body>
    <button id="link-btn">Link a bank</button>
    <pre id="log" style="white-space:pre-wrap"></pre>
    <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
    <script>
      const log = (m) => (document.getElementById('log').textContent += m + "\n");
      async function openLink() {
        const lt = await fetch("/create_link_token", {method:"POST"}).then(r=>r.json());
        const handler = Plaid.create({
          token: lt.link_token,
          onSuccess: async (public_token, metadata) => {
            log("Exchanging token…");
            const res = await fetch("/exchange_public_token", {
              method: "POST",
              headers: {"Content-Type":"application/json"},
              body: JSON.stringify({
                public_token,
                institution_name: metadata?.institution?.name || "Bank"
              })
            }).then(r=>r.json());
            if (res.ok) log("✅ Saved access_token for: " + res.issuer);
            else log("❌ Exchange failed");
          },
          onExit: (err) => { if (err) log("Exit: " + err.error_code); }
        });
        handler.open();
      }
      document.getElementById('link-btn').onclick = openLink;
    </script>
  </body>
</html>